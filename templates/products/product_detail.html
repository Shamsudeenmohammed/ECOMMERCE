{% extends "base.html" %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<style>
/* ===== PRODUCT DETAIL LAYOUT ===== */
.product-detail {
  display: flex;
  gap: 40px;
  max-width: 1100px;
  margin: 40px auto;
  padding: 20px;
}

/* IMAGE SECTION */
.product-images { flex: 1; }
.main-image { width: 100%; height: 420px; object-fit: cover; border-radius: 12px; background: #f3f4f6; }
.thumbnail-row { display: flex; gap: 10px; margin-top: 12px; }
.thumbnail { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: border 0.2s ease; }
.thumbnail:hover { border-color: #2563eb; }
.image-placeholder.large { height: 420px; display: flex; align-items: center; justify-content: center; background: #e5e7eb; border-radius: 12px; color: #555; }

/* PRODUCT INFO */
.product-info { flex: 1; }
.product-info h2 { font-size: 28px; margin-bottom: 10px; }
.price { font-size: 22px; font-weight: bold; color: #2563eb; margin-bottom: 15px; }
.description { margin-bottom: 20px; line-height: 1.6; color: #444; }
.stock { margin-bottom: 20px; font-weight: 600; }
.stock.in { color: #16a34a; }
.stock.out { color: #dc2626; }

/* BUTTONS */
.btn {
  display: inline-block;
  padding: 12px 22px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 15px;
  font-weight: 600;
}
.btn.primary { background: #16a34a; color: white; }
.btn.primary:hover { background: #15803d; }

.btn.disabled {
  background: #9ca3af;
  color: #fff;
  cursor: not-allowed;
}

/* RESPONSIVE */
@media (max-width: 900px) {
  .product-detail { flex-direction: column; }
  .main-image { height: 320px; }
}
</style>

<div class="product-detail">

  <!-- IMAGE SECTION -->
  <div class="product-images">
    {% if images %}
      <img src="{{ images.0.image.url }}" class="main-image">
      <div class="thumbnail-row">
        {% for img in images %}
          <img src="{{ img.image.url }}" class="thumbnail">
        {% endfor %}
      </div>
    {% else %}
      <div class="image-placeholder large">No Image</div>
    {% endif %}
  </div>

  <!-- PRODUCT INFO -->
  <div class="product-info">
    <h2>{{ product.name }}</h2>
    <p class="price">GHS {{ product.price }}</p>
    <p class="description">{{ product.description }}</p>

    {% if product.stock > 0 and product.is_active %}
      <p class="stock in" id="stock-text">
        Only <strong>{{ product.stock }}</strong> left in stock üî•
      </p>

      <a href="{% url 'cart:add_to_cart' product.id %}" class="btn primary" id="add-to-cart">
        Add to Cart
      </a>
    {% else %}
      <p class="stock out" id="stock-text">Out of Stock</p>
      <span class="btn disabled" id="add-to-cart">Unavailable</span>
    {% endif %}
  </div>

</div>

<script>
setInterval(function () {
  fetch(window.location.href, {
    headers: {
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  .then(res => res.json())
  .then(data => {
    const stockText = document.getElementById('stock-text');
    const addBtn = document.getElementById('add-to-cart');

    if (!stockText || !addBtn) return;

    if (data.stock > 0 && data.is_active) {
      stockText.innerHTML = `Only <strong>${data.stock}</strong> left in stock üî•`;
      stockText.className = 'stock in';

      addBtn.innerText = 'Add to Cart';
      addBtn.className = 'btn primary';
      addBtn.removeAttribute('disabled');
    } else {
      stockText.innerText = 'Out of Stock';
      stockText.className = 'stock out';

      addBtn.innerText = 'Unavailable';
      addBtn.className = 'btn disabled';
      addBtn.setAttribute('disabled', true);
    }
  });
}, 10000); // ‚è± every 10 seconds
</script>


{% endblock %}
